!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/router"),require("rxjs/operators"),require("@angular/common/http"),require("rxjs")):"function"==typeof define&&define.amd?define("ngx-auth",["exports","@angular/core","@angular/common","@angular/router","rxjs/operators","@angular/common/http","rxjs"],t):t(e["ngx-auth"]={},e.ng.core,e.ng.common,e.ng.router,e.rxjs.operators,e.ng.common.http,e.rxjs)}(this,function(e,t,r,n,o,i,s){"use strict";var c=function(){},u=new t.InjectionToken("AUTH_SERVICE"),a=new t.InjectionToken("PUBLIC_FALLBACK_PAGE_URI"),p=new t.InjectionToken("PROTECTED_FALLBACK_PAGE_URI"),h=(f.prototype.canActivate=function(e,t){var r=this;return this.authService.isAuthorized().pipe(o.map(function(e){return!(e&&!r.isProtectedPage(t))||(r.navigate(r.protectedFallbackPageUri),!1)}))},f.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},f.prototype.isProtectedPage=function(e){return e.url===this.protectedFallbackPageUri},f.prototype.navigate=function(e){e.startsWith("http")?this.document.location.href=e:this.router.navigateByUrl(e)},f.decorators=[{type:t.Injectable}],f.ctorParameters=function(){return[{type:c,decorators:[{type:t.Inject,args:[u]}]},{type:String,decorators:[{type:t.Inject,args:[p]}]},{type:Document,decorators:[{type:t.Inject,args:[r.DOCUMENT]}]},{type:n.Router}]},f);function f(e,t,r,n){this.authService=e,this.protectedFallbackPageUri=t,this.document=r,this.router=n}var l=(d.prototype.canActivate=function(e,t){var r=this;return this.authService.isAuthorized().pipe(o.map(function(e){return!(!e&&!r.isPublicPage(t))||(r.authService.setInterruptedUrl&&r.authService.setInterruptedUrl(t.url),r.navigate(r.publicFallbackPageUri),!1)}))},d.prototype.canActivateChild=function(e,t){return this.canActivate(e,t)},d.prototype.isPublicPage=function(e){return e.url===this.publicFallbackPageUri},d.prototype.navigate=function(e){e.startsWith("http")?this.document.location.href=e:this.router.navigateByUrl(e)},d.decorators=[{type:t.Injectable}],d.ctorParameters=function(){return[{type:c,decorators:[{type:t.Inject,args:[u]}]},{type:String,decorators:[{type:t.Inject,args:[a]}]},{type:Document,decorators:[{type:t.Inject,args:[r.DOCUMENT]}]},{type:n.Router}]},d);function d(e,t,r,n){this.authService=e,this.publicFallbackPageUri=t,this.document=r,this.router=n}function y(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)s.push(n.value)}catch(c){o={error:c}}finally{try{n&&!n.done&&(r=i["return"])&&r.call(i)}finally{if(o)throw o.error}}return s}var g=(v.prototype.intercept=function(e,t){return this.skipRequest(e)?t.handle(e):this.processIntercept(e,t)},v.prototype.processIntercept=function(e,t){var r=this,n=e.clone();return this.request(n).pipe(o.switchMap(function(e){return t.handle(e)}),o.catchError(function(e){return r.responseError(n,e)}))},v.prototype.request=function(e){return this.refreshInProgress?this.delayRequest(e):this.addToken(e)},v.prototype.responseError=function(e,t){var r=this,n=this.injector.get(u),o=n.refreshShouldHappen(t,e);return o&&!this.refreshInProgress&&(this.refreshInProgress=!0,n.refreshToken().subscribe(function(){r.refreshInProgress=!1,r.refreshSubject.next(!0)},function(){r.refreshInProgress=!1,r.refreshSubject.next(!1)})),o&&this.refreshInProgress?this.retryRequest(e,t):s.throwError(t)},v.prototype.addToken=function(r){var n=this.injector.get(u);return n.getAccessToken().pipe(o.map(function(e){if(e){var t=void 0,t="function"==typeof n.getHeaders?n.getHeaders(e):{Authorization:"Bearer "+e};return r.clone({setHeaders:t})}return r}),o.first())},v.prototype.delayRequest=function(t){var r=this;return this.refreshSubject.pipe(o.first(),o.switchMap(function(e){return e?r.addToken(t):s.throwError(t)}))},v.prototype.retryRequest=function(t,r){var n=this.injector.get(i.HttpClient);return this.refreshSubject.pipe(o.first(),o.switchMap(function(e){return e?n.request(t):s.throwError(r||t)}))},v.prototype.skipRequest=function(e){var t=this.exec("skipRequest",e),r=this.exec("verifyRefreshToken",e),e=this.exec("verifyTokenRequest",e.url);return t||r||e},v.prototype.exec=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=this.injector.get(u);if("function"==typeof n[e])return n[e].apply(n,function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(y(arguments[t]));return e}(t))},v.decorators=[{type:t.Injectable}],v.ctorParameters=function(){return[{type:t.Injector}]},v);function v(e){this.injector=e,this.refreshInProgress=!1,this.refreshSubject=new s.Subject}var P=(I.decorators=[{type:t.NgModule,args:[{providers:[h,l,g,{provide:i.HTTP_INTERCEPTORS,useClass:g,multi:!0}]}]}],I);function I(){}e.AuthService=c,e.PublicGuard=h,e.ProtectedGuard=l,e.AUTH_SERVICE=u,e.PUBLIC_FALLBACK_PAGE_URI=a,e.PROTECTED_FALLBACK_PAGE_URI=p,e.AuthModule=P,e.Éµa=g,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ngx-auth.umd.min.js.map