{"version":3,"file":"translate.pipe.js","sources":["@ngx-translate/core/projects/ngx-translate/core/src/lib/translate.pipe.ts"],"names":[],"mappings":"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","sourcesContent":["import {ChangeDetectorRef, EventEmitter, Injectable, OnDestroy, Pipe, PipeTransform} from '@angular/core';\nimport {DefaultLangChangeEvent, LangChangeEvent, TranslateService, TranslationChangeEvent} from './translate.service';\nimport {equals, isDefined} from './util';\n\n@Injectable()\n@Pipe({\n  name: 'translate',\n  pure: false // required to update the value when the promise is resolved\n})\nexport class TranslatePipe implements PipeTransform, OnDestroy {\n  value: string = '';\n  lastKey: string;\n  lastParams: any[];\n  onTranslationChange: EventEmitter<TranslationChangeEvent>;\n  onLangChange: EventEmitter<LangChangeEvent>;\n  onDefaultLangChange: EventEmitter<DefaultLangChangeEvent>;\n\n  constructor(private translate: TranslateService, private _ref: ChangeDetectorRef) {\n  }\n\n  updateValue(key: string, interpolateParams?: Object, translations?: any): void {\n    let onTranslation = (res: string) => {\n      this.value = res !== undefined ? res : key;\n      this.lastKey = key;\n      this._ref.markForCheck();\n    };\n    if (translations) {\n      let res = this.translate.getParsedResult(translations, key, interpolateParams);\n      if (typeof res.subscribe === 'function') {\n        res.subscribe(onTranslation);\n      } else {\n        onTranslation(res);\n      }\n    }\n    this.translate.get(key, interpolateParams).subscribe(onTranslation);\n  }\n\n  transform(query: string, ...args: any[]): any {\n    if (!query || query.length === 0) {\n      return query;\n    }\n\n    // if we ask another time for the same key, return the last value\n    if (equals(query, this.lastKey) && equals(args, this.lastParams)) {\n      return this.value;\n    }\n\n    let interpolateParams: Object;\n    if (isDefined(args[0]) && args.length) {\n      if (typeof args[0] === 'string' && args[0].length) {\n        // we accept objects written in the template such as {n:1}, {'n':1}, {n:'v'}\n        // which is why we might need to change it to real JSON objects such as {\"n\":1} or {\"n\":\"v\"}\n        let validArgs: string = args[0]\n          .replace(/(\\')?([a-zA-Z0-9_]+)(\\')?(\\s)?:/g, '\"$2\":')\n          .replace(/:(\\s)?(\\')(.*?)(\\')/g, ':\"$3\"');\n        try {\n          interpolateParams = JSON.parse(validArgs);\n        } catch (e) {\n          throw new SyntaxError(`Wrong parameter in TranslatePipe. Expected a valid Object, received: ${args[0]}`);\n        }\n      } else if (typeof args[0] === 'object' && !Array.isArray(args[0])) {\n        interpolateParams = args[0];\n      }\n    }\n\n    // store the query, in case it changes\n    this.lastKey = query;\n\n    // store the params, in case they change\n    this.lastParams = args;\n\n    // set the value\n    this.updateValue(query, interpolateParams);\n\n    // if there is a subscription to onLangChange, clean it\n    this._dispose();\n\n    // subscribe to onTranslationChange event, in case the translations change\n    if (!this.onTranslationChange) {\n      this.onTranslationChange = this.translate.onTranslationChange.subscribe((event: TranslationChangeEvent) => {\n        if (this.lastKey && event.lang === this.translate.currentLang) {\n          this.lastKey = null;\n          this.updateValue(query, interpolateParams, event.translations);\n        }\n      });\n    }\n\n    // subscribe to onLangChange event, in case the language changes\n    if (!this.onLangChange) {\n      this.onLangChange = this.translate.onLangChange.subscribe((event: LangChangeEvent) => {\n        if (this.lastKey) {\n          this.lastKey = null; // we want to make sure it doesn't return the same value until it's been updated\n          this.updateValue(query, interpolateParams, event.translations);\n        }\n      });\n    }\n\n    // subscribe to onDefaultLangChange event, in case the default language changes\n    if (!this.onDefaultLangChange) {\n      this.onDefaultLangChange = this.translate.onDefaultLangChange.subscribe(() => {\n        if (this.lastKey) {\n          this.lastKey = null; // we want to make sure it doesn't return the same value until it's been updated\n          this.updateValue(query, interpolateParams);\n        }\n      });\n    }\n\n    return this.value;\n  }\n\n  /**\n   * Clean any existing subscription to change events\n   */\n  private _dispose(): void {\n    if (typeof this.onTranslationChange !== 'undefined') {\n      this.onTranslationChange.unsubscribe();\n      this.onTranslationChange = undefined;\n    }\n    if (typeof this.onLangChange !== 'undefined') {\n      this.onLangChange.unsubscribe();\n      this.onLangChange = undefined;\n    }\n    if (typeof this.onDefaultLangChange !== 'undefined') {\n      this.onDefaultLangChange.unsubscribe();\n      this.onDefaultLangChange = undefined;\n    }\n  }\n\n  ngOnDestroy(): void {\n    this._dispose();\n  }\n}\n"]}